<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GCash Payment Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}
:root {
  --primary: #1a1a1a;
  --secondary: #2d2d2d;
  --accent: #554024;
  --accent-hover: #4d4024;
  --success: #10b981;
  --text-primary: #ffffff;
  --text-secondary: #a3a3a3;
  --border: #404040;
  --input-bg: #2d2d2d;
}
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  min-height: 100vh;
  color: var(--text-primary);
  padding: 0;
  overflow-x: hidden;
}
.container {
  max-width: 480px;
  margin: 0 auto;
  padding: 16px;
  min-height: 100vh;
}
.checkout-card {
  background: var(--primary);
  border-radius: 24px;
  border: 1px solid var(--border);
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
  animation: fadeIn 0.5s ease;
}
.header {
  background: linear-gradient(135deg, var(--accent) 0%, #31280e 100%);
  padding: 32px 24px;
  text-align: center;
}
.header h1 {
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 4px;
  letter-spacing: -0.5px;
}
.header .subtitle {
  font-size: 14px;
  opacity: 0.9;
  font-weight: 500;
}
.section {
  padding: 24px;
  border-bottom: 1px solid var(--border);
}
.section:last-child { border-bottom: none; }
.section-title {
  font-size: 13px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.cart-items {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 240px;
  overflow-y: auto;
  padding-right: 4px;
}
.cart-items::-webkit-scrollbar { width: 4px; }
.cart-items::-webkit-scrollbar-track { background: var(--secondary); border-radius: 4px; }
.cart-items::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 4px; }
.cart-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--secondary);
  border-radius: 12px;
  border: 1px solid var(--border);
}
.item-name { font-size: 15px; font-weight: 500; flex: 1; }
.item-price { font-size: 15px; font-weight: 600; color: var(--accent); }
.cart-total {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  background: var(--secondary);
  margin: 16px 0 0 0;
  border-radius: 16px;
  border: 2px solid var(--accent);
}
.total-label { font-size: 16px; font-weight: 600; color: var(--text-secondary); }
.total-amount { font-size: 24px; font-weight: 700; color: var(--accent); }
.qr-container { text-align: center; padding: 16px; }
.qr-code {
  width: 200px; height: 200px; margin: 16px auto; border-radius: 16px;
  border: 2px solid var(--border); background: white; padding: 12px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}
.qr-instruction { font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; }
.form-group { margin-bottom: 16px; }
.form-label {
  display: block; font-size: 13px; font-weight: 600;
  color: var(--text-secondary); margin-bottom: 8px;
  text-transform: uppercase; letter-spacing: 0.3px;
}
.form-input {
  width: 100%; padding: 14px 16px; background: var(--input-bg);
  border: 1px solid var(--border); border-radius: 12px; color: var(--text-primary);
  font-size: 15px; font-family: inherit; transition: all 0.2s;
}
.form-input:focus {
  outline: none; border-color: var(--accent); background: var(--secondary);
  box-shadow: 0 0 0 3px rgba(14,165,233,0.1);
}
.form-input::placeholder { color: #666; }
.file-upload { position: relative; width: 100%; margin-bottom: 16px; }
.file-upload-input {
  position: absolute; width: 1px; height: 1px; opacity: 0; overflow: hidden; z-index: -1;
}
.file-upload-label {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 12px; padding: 32px 20px; background: var(--secondary);
  border: 2px dashed var(--border); border-radius: 16px; cursor: pointer; transition: all 0.3s;
  text-align: center; min-height: 140px;
}
.file-upload-label:active { transform: scale(0.98); }
.file-upload-label:hover { border-color: var(--accent); background: var(--input-bg); }
.upload-icon { font-size: 40px; opacity: 0.6; }
.upload-text { font-size: 15px; font-weight: 500; color: var(--text-primary); }
.upload-subtext { font-size: 13px; color: var(--text-secondary); }
.file-name-display {
  margin-top: 12px; padding: 12px 16px; background: var(--accent); color: white;
  border-radius: 8px; font-size: 14px; font-weight: 500;
  display: flex; align-items: center; gap: 8px; animation: slideDown 0.3s ease;
}
@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
.preview-container { margin-top: 16px; text-align: center; }
.preview-image { max-width: 100%; max-height: 300px; border-radius: 12px; border: 2px solid var(--border);
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}
.submit-btn {
  width: 100%; padding: 16px; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
  border: none; border-radius: 16px; color: white; font-size: 16px; font-weight: 600; cursor: pointer;
  transition: all 0.3s; box-shadow: 0 4px 16px rgba(14,165,233,0.3); font-family: inherit;
}
.submit-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(14,165,233,0.4); }
.submit-btn:active:not(:disabled) { transform: translateY(0); }
.submit-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
.note { text-align: center; font-size: 13px; color: var(--text-secondary); margin-top: 16px; padding: 12px; background: var(--secondary); border-radius: 8px; }
.empty-cart { text-align: center; padding: 40px 20px; color: var(--text-secondary); }
.empty-cart-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
.step-badge { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; background: var(--accent); border-radius: 50%; font-size: 12px; font-weight: 700; }
.loading-overlay {
  position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8);
  display: flex; align-items: center; justify-content: center; z-index: 9999; flex-direction: column; gap: 16px;
}
.spinner { width: 50px; height: 50px; border: 4px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
@media (max-width: 480px) { .container { padding: 12px; } .header { padding: 24px 20px; } .header h1 { font-size: 20px; } .section { padding: 20px; } .qr-code { width: 180px; height: 180px; } .cart-total { padding: 16px 20px; } .total-amount { font-size: 20px; } }
@media (min-width: 481px) { .container { padding: 24px; display: flex; align-items: center; } .checkout-card { width: 100%; } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
  <div class="container">
    <div class="checkout-card">
      <div class="header">
        <h1>üí≥ Secure Checkout</h1>
        <p class="subtitle">Complete your order</p>
      </div>

      <!-- Order Summary -->
      <div class="section">
        <div class="section-title">
          <span class="step-badge">1</span>
          ORDER SUMMARY
        </div>
        <div class="cart-items" id="cart-list"></div>
        <div class="cart-total">
          <span class="total-label">Total</span>
          <span class="total-amount" id="checkout-total">‚Ç±0.00</span>
        </div>
      </div>

      <!-- Scan & Pay -->
      <div class="section">
        <div class="section-title">
          <span class="step-badge">2</span>
          SCAN & PAY
        </div>
        <div class="qr-container">
          <p class="qr-instruction">Scan with your GCash app</p>
          <img src="assets/gcash-qr.png" alt="GCash QR" class="qr-code">
        </div>
      </div>

      <!-- Delivery Details -->
      <div class="section">
        <div class="section-title">
          <span class="step-badge">3</span>
          DELIVERY DETAILS
        </div>
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input type="text" id="customer-name" class="form-input" placeholder="Juan Dela Cruz" required>
        </div>
        <div class="form-group">
          <label class="form-label">Phone Number</label>
          <input type="tel" id="customer-phone" class="form-input" placeholder="09171234567" required>
        </div>
        <div class="form-group">
          <label class="form-label">Delivery Address</label>
          <input type="text" id="customer-address" class="form-input" placeholder="123 Main St, Quezon City" required>
        </div>
      </div>

      <!-- Payment Proof -->
      <div class="section">
        <div class="section-title">
          <span class="step-badge">4</span>
          PAYMENT PROOF
        </div>
        <div class="form-group">
          <label class="form-label">Screenshot Upload</label>
          <div class="file-upload">
            <input type="file" id="payment-proof" class="file-upload-input" accept="image/*" capture="environment" required>
            <label for="payment-proof" class="file-upload-label">
              <span class="upload-icon">üì∏</span>
              <span class="upload-text">Tap to upload screenshot</span>
              <span class="upload-subtext">JPG, PNG or HEIC</span>
            </label>
            <div id="file-name" style="display: none;" class="file-name-display"></div>
          </div>
        </div>
        <div id="preview" class="preview-container"></div>
        <div class="form-group">
          <label class="form-label">Reference Number</label>
          <input type="text" id="reference-number" class="form-input" placeholder="1234567890123" maxlength="13" inputmode="numeric" required>
        </div>
      </div>

      <!-- Submit -->
      <div class="section">
        <button id="confirm-btn" class="submit-btn" onclick="confirmPayment()">
          üîí Submit Order
        </button>
        <p class="note">‚ö†Ô∏è Demo only - No real payment processed</p>
      </div>
    </div>
  </div>

  <script>
  const API_URL = 'https://final-project-wujp.onrender.com';
  const cart = JSON.parse(localStorage.getItem('demoCart') || '[]');
  const cartList = document.getElementById('cart-list');
  let total = 0;
  let uploadedImageUrl = '';

  if (cart.length === 0) {
    cartList.innerHTML = `
      <div class="empty-cart">
        <div class="empty-cart-icon">üõí</div>
        <p>Your cart is empty</p>
      </div>
    `;
  } else {
    cart.forEach(item => {
      total += item.price * item.qty;
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <span class="item-name">${item.name} √ó${item.qty}</span>
        <span class="item-price">‚Ç±${(item.price * item.qty).toFixed(2)}</span>
      `;
      cartList.appendChild(div);
    });
  }

  document.getElementById('checkout-total').textContent = '‚Ç±' + total.toFixed(2);

  // File upload with Cloudinary
  const fileInput = document.getElementById('payment-proof');
  const fileNameDisplay = document.getElementById('file-name');
  const previewContainer = document.getElementById('preview');

  fileInput.addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (file) {
      fileNameDisplay.style.display = 'flex';
      fileNameDisplay.innerHTML = `‚úì ${file.name}`;

      // Preview locally
      const reader = new FileReader();
      reader.onload = function(event) {
        previewContainer.innerHTML = `<img src="${event.target.result}" alt="Payment Screenshot" class="preview-image">`;
      };
      reader.readAsDataURL(file);

      // Upload to Cloudinary
      showLoading('Uploading image...');
      try {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', 'demo_preset'); // replace with your preset

        const response = await fetch('https://api.cloudinary.com/v1_1/dsfy5akpz/image/upload', { // replace with your cloud name
          method: 'POST',
          body: formData
        });

        const data = await response.json();
        uploadedImageUrl = data.secure_url;
        console.log('Image uploaded:', uploadedImageUrl);

      } catch (error) {
        console.error('Cloudinary upload error:', error);
        alert('‚ö†Ô∏è Image upload failed, but filename will be saved.');
      } finally {
        hideLoading();
      }
    }
  });

  // Input validation
  document.getElementById('customer-phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 11) value = value.slice(0, 11);
    e.target.value = value;
  });

  document.getElementById('reference-number').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 13) value = value.slice(0, 13);
    e.target.value = value;
  });

  function showLoading(message) {
    const overlay = document.createElement('div');
    overlay.id = 'loading-overlay';
    overlay.className = 'loading-overlay';
    overlay.innerHTML = `
      <div class="spinner"></div>
      <p style="color: white; font-size: 16px;">${message}</p>
    `;
    document.body.appendChild(overlay);
  }

  function hideLoading() {
    const overlay = document.getElementById('loading-overlay');
    if (overlay) overlay.remove();
  }

  async function confirmPayment() {
    const name = document.getElementById('customer-name').value.trim();
    const phone = document.getElementById('customer-phone').value.trim();
    const address = document.getElementById('customer-address').value.trim();
    const proofFile = document.getElementById('payment-proof').files[0];
    const refNum = document.getElementById('reference-number').value.trim();

    if (!name || !phone || !address || !proofFile || !refNum) {
      alert('‚ùå Please complete all fields');
      return;
    }

    if (phone.length < 10) {
      alert('‚ùå Please enter a valid phone number (10-11 digits)');
      return;
    }

    if (refNum.length !== 13) {
      alert('‚ùå GCash reference number must be exactly 13 digits');
      return;
    }

    if (cart.length === 0) {
      alert('‚ùå Your cart is empty!');
      return;
    }

    const btn = document.getElementById('confirm-btn');
    btn.disabled = true;
    btn.textContent = '‚è≥ Submitting...';

    const order = {
      id: 'ORD' + Date.now(),
      customerName: name,
      phone: phone,
      address: address,
      items: cart,
      total: total,
      referenceNumber: refNum,
      paymentProof: uploadedImageUrl || proofFile.name
    };

    try {
      const response = await fetch(`${API_URL}/api/orders`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(order)
      });

      if (response.ok) {
        localStorage.removeItem('demoCart');
        alert(`‚úÖ Order Submitted Successfully!\n\nOrder ID: ${order.id}\nTotal: ‚Ç±${total.toFixed(2)}`);
        window.location.href = 'thankyou.html';
      } else {
        throw new Error('Server error');
      }
    } catch (error) {
      console.error('Order submission error:', error);
      alert('‚ùå Error submitting order. Please try again.');
      btn.disabled = false;
      btn.textContent = 'üîí Submit Order';
    }
  }

  window.addEventListener('beforeunload', function (e) {
    const name = document.getElementById('customer-name').value.trim();
    if (name && cart.length > 0) {
      e.preventDefault();
      e.returnValue = '';
    }
  });
  </script>
</body>
</html>
